<section class="products-section">
  <h3>Productos</h3>
  <hr style="width: 55%; border: 1px solid #000000;">
  <button mat-raised-button color="primary" [routerLink]="['/producto/agregar']">Agregar Producto</button>
  <div class="card_viewholder">
    @if (listaProductos().length === 1 && listaProductos()[0].nombre === "ERROR") {
      <h4 class="alert alert-danger">Ocurrio un problema, intentelo de nuevo mas tarde</h4>
    } @else {
      @defer (when listaProductos().length >= 4) {
        <mat-card appearance="outlined"
                  *ngFor="let producto of listaProductos()
                | slice: lowIndex: highIndex">
          <mat-card-header>
            <div mat-card-avatar class="matCard-header-image"></div>
            <mat-card-title class="fw-bold"
                            style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{ producto.nombre }}
            </mat-card-title>
            <mat-card-subtitle class="text-muted">{{ producto.username }}</mat-card-subtitle>
            <mat-card-subtitle>S/ {{ producto.precio }}</mat-card-subtitle>
          </mat-card-header>
          @if (producto.imagen) {
            <img mat-card-image [src]="producto.imagen" alt="Product Image">
          } @else {
            <img
              src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Foperaparallele.org%2Fwp-content%2Fuploads%2F2023%2F09%2FPlaceholder_Image.png&f=1&nofb=1&ipt=2348c8b3caeaf10947e1e8bdc358cb05407520976ae4ad53489a48a1fcce992c"
              height="200px" width="400px">
          }
          <mat-card-actions style="display: flex; justify-content: space-around;">
            <button mat-button [routerLink]="['/producto/actualizar', producto.idProducto]">Actualizar</button>
            <button mat-button [routerLink]="['/producto', producto.idProducto]">Detalles</button>
            <button style="color: red" mat-button (click)="eliminarProducto(producto.idProducto)">Eliminar</button>
          </mat-card-actions>
        </mat-card>
      } @placeholder (minimum 100) {
        <mat-spinner></mat-spinner>
      }
    }
  </div>
  <mat-paginator
    [length]="listaProductos().length"
    [pageSize]="pageSize"
    (page)="getPaginatorData($event)"
  ></mat-paginator>
</section>
