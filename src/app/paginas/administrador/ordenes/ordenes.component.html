<div class="container py-4">
  <h2 class="mb-4 text-center">Órdenes Registradas</h2>

  <div *ngIf="cargando" class="text-center py-3">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <div *ngIf="ordenes.length === 0 && !cargando" class="alert alert-info text-center">
    No hay órdenes registradas en el sistema.
  </div>

  <div *ngIf="ordenes.length > 0" class="card shadow-lg border-0 rounded-4 overflow-hidden">
    <div class="card-header bg-gradient-primary text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0"><i class="bi bi-receipt-cutoff me-2"></i>Listado de Órdenes</h5>
      <span class="badge bg-light text-primary">{{ ordenes.length }} en total</span>
    </div>
    <div class="table-responsive">
      <table class="table table-striped table-hover mb-0 align-middle">
        <thead class="table-dark text-uppercase small">
          <tr>
            <th class="ps-4">Orden #</th>
            <th>Cliente</th>
            <th>Fecha</th>
            <th>Total</th>
            <th class="text-center pe-4">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let ord of ordenes">
            <td class="ps-4 fw-bold text-primary">{{ (ord.numeroOrden + '').padStart(5,'0') }}</td>
            <td>{{ ord.usuario.nombre || 'Cliente desconocido' }}</td>
            <td>{{ ord.fecha | date:'dd/MM/yyyy' }}</td>
            <td class="fw-semibold">S/ {{ ord.total | number:'1.2-2' }}</td>
            <td class="text-center pe-4">
              <button class="btn btn-outline-light btn-sm bg-primary bg-opacity-10 border-0 rounded-pill px-3"
                      (click)="verDetalle(ord)">
                <i class="bi bi-eye-fill me-1"></i>Ver Detalle
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal de Detalle -->
  <div class="modal fade" id="modalDetalleOrden" tabindex="-1" aria-labelledby="modalDetalleLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalDetalleLabel">
            Detalle de Orden #{{ (ordenSeleccionada?.numeroOrden + '').padStart(5,'0') }}
          </h5>
          <button type="button" class="btn-close" (click)="cerrarModalDetalle()" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          
          <!-- Detalle Producto -->
          <div *ngIf="detalleProducto.length > 0">
            <h6 class="mb-3 text-primary">Productos</h6>
            <table class="table table-sm table-bordered">
              <thead class="table-light">
                <tr>
                  <th>Producto</th>
                  <th>Cantidad</th>
                  <th>Precio Unitario</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let det of detalleProducto">
                  <td>{{ det.nombre }}</td>
                  <td>{{ det.cantidad }}</td>
                  <td>S/ {{ det.precio | number:'1.2-2' }}</td>
                  <td class="fw-semibold">S/ {{ det.total | number:'1.2-2' }}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Detalle Servicio -->
          <div *ngIf="detalleServicio.length > 0">
            <h6 class="mb-3 text-success">Servicios</h6>
            <table class="table table-sm table-bordered">
              <thead class="table-light">
                <tr>
                  <th>Servicio</th>
                  <th>Mascota ID</th>
                  <th>Fecha Cita</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let det of detalleServicio">
                  <td>{{ det.nombre }}</td>
                  <td>{{ det.mascota.idMascota }}</td>
                  <td>{{ det.fechaCita | date:'dd/MM/yyyy' }}</td>
                  <td class="fw-semibold">S/ {{ det.total | number:'1.2-2' }}</td>
                </tr>
              </tbody>
            </table>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="cerrarModalDetalle()">Cerrar</button>
        </div>
      </div>
    </div>
  </div>
</div>
